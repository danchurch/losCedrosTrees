

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Nodata Masks &mdash; rasterio  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="In-Memory Files" href="memory-files.html" />
    <link rel="prev" title="Masking a raster using a shapefile" href="masking-by-shapefile.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="masks.html" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": false, "api_host": "https://readthedocs.org", "build_date": "2020-07-08T18:00:58Z", "builder": "sphinx", "canonical_url": "https://rasterio.readthedocs.io/en/latest/", "commit": "3ae51c8e", "docroot": "/docs/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "topics/masks", "programming_language": "py", "project": "rasterio", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_rtd_theme", "user_analytics_code": "", "version": "latest"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js" async="async"></script>
<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> rasterio
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Python Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advanced Topics</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="calc.html">Using rio-calc</a></li>
<li class="toctree-l2"><a class="reference internal" href="color.html">Color</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrency.html">Concurrent processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">GDAL Option Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasets.html">Advanced Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html">Vector Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="fillnodata.html">Filling nodata areas</a></li>
<li class="toctree-l2"><a class="reference internal" href="georeferencing.html">Georeferencing</a></li>
<li class="toctree-l2"><a class="reference internal" href="image_options.html">Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="image_processing.html">Interoperability</a></li>
<li class="toctree-l2"><a class="reference internal" href="masking-by-shapefile.html">Masking a raster using a shapefile</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="masks.html#">Nodata Masks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="masks.html#reading-dataset-masks">Reading dataset masks</a></li>
<li class="toctree-l3"><a class="reference internal" href="masks.html#writing-masks">Writing masks</a></li>
<li class="toctree-l3"><a class="reference internal" href="masks.html#numpy-masked-arrays">Numpy masked arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="masks.html#dataset-masks">Dataset masks</a></li>
<li class="toctree-l3"><a class="reference internal" href="masks.html#nodata-representations-in-raster-files">Nodata representations in raster files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="memory-files.html">In-Memory Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-to-v1.html">Migrating to Rasterio 1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="overviews.html">Overviews</a></li>
<li class="toctree-l2"><a class="reference internal" href="plotting.html">Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiles.html">Profiles and Writing Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="reading.html">Reading Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="reproject.html">Reprojection</a></li>
<li class="toctree-l2"><a class="reference internal" href="resampling.html">Resampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="switch.html">Switching from GDAL’s Python bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="tags.html">Tagging datasets and bands</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtual-warping.html">Virtual Warping</a></li>
<li class="toctree-l2"><a class="reference internal" href="vsi.html">Virtual Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="windowed-rw.html">Windowed reading and writing</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing.html">Writing Datasets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">rasterio</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Advanced Topics</a> &raquo;</li>
        
      <li>Nodata Masks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/mapbox/rasterio/blob/master/docs/topics/masks.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="nodata-masks">
<h1>Nodata Masks<a class="headerlink" href="masks.html#nodata-masks" title="Permalink to this headline">¶</a></h1>
<p>Nodata masks allow you to identify regions of valid data values. In using Rasterio,
you’ll encounter two different kinds of masks.</p>
<p>One is the the valid data mask from GDAL, an unsigned byte array with the same number of
rows and columns as the dataset in which non-zero elements (typically 255) indicate that the
corresponding data elements are valid. Other elements are invalid, or <em>nodata</em>
elements.</p>
<p>The other kind of mask is Numpy’s <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/maskedarray.generic.html">masked array</a>
which has the inverse sense: <cite>True</cite> values in a masked array’s mask indicate
that the corresponding data elements are invalid. With care, you can safely
navigate convert between the two mask types.</p>
<p>Consider Rasterio’s RGB.byte.tif test dataset. It has 718 rows and 791
columns of pixels. Each pixel has 3 8-bit (uint8) channels or bands. It has a
trapezoid of image data within a rectangular background of 0,0,0 value pixels.</p>
<img alt="https://www.dropbox.com/s/sg7qejccih5m4ah/RGB.byte.jpg?dl=1" src="https://www.dropbox.com/s/sg7qejccih5m4ah/RGB.byte.jpg?dl=1" />
<p>Metadata in the dataset declares that values of 0 will be interpreted as
invalid data or <em>nodata</em> pixels. In, e.g., merging the image with adjacent
scenes, we’d like to ignore the nodata pixels and have only valid image data in
our final mosaic.</p>
<p>Let’s look at the two kinds of masks and their
inverse relationship in the context of RGB.byte.tif.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span>&gt;&gt; import rasterio
<span class="gp">&gt;</span>&gt;&gt; <span class="nv">src</span> <span class="o">=</span> rasterio.open<span class="o">(</span><span class="s2">&quot;tests/data/RGB.byte.tif&quot;</span><span class="o">)</span>
<span class="gp">&gt;</span>&gt;&gt; src.shape
<span class="gp gp-VirtualEnv">(718, 791)</span>
<span class="gp">&gt;</span>&gt;&gt; src.count
<span class="go">3</span>
<span class="gp">&gt;</span>&gt;&gt; src.dtypes
<span class="gp gp-VirtualEnv">(&#39;uint8&#39;, &#39;uint8&#39;, &#39;uint8&#39;)</span>
<span class="gp">&gt;</span>&gt;&gt; src.nodatavals
<span class="gp gp-VirtualEnv">(0.0, 0.0, 0.0)</span>
<span class="gp">&gt;</span>&gt;&gt; src.nodata
<span class="go">0.0</span>
</pre></div>
</div>
<div class="section" id="reading-dataset-masks">
<h2>Reading dataset masks<a class="headerlink" href="masks.html#reading-dataset-masks" title="Permalink to this headline">¶</a></h2>
<p>For every band of a dataset there is a mask. These masks can be had as arrays
using the dataset’s <cite>read_masks()`</cite> method. Below, <code class="docutils literal notranslate"><span class="pre">msk</span></code> is the valid data
mask corresponding to the first dataset band.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">msk</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read_masks</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msk</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(718, 791)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msk</span>
<span class="go">array([[0, 0, 0, ..., 0, 0, 0],</span>
<span class="go">       [0, 0, 0, ..., 0, 0, 0],</span>
<span class="go">       [0, 0, 0, ..., 0, 0, 0],</span>
<span class="go">       ...</span>
<span class="go">       [0, 0, 0, ..., 0, 0, 0],</span>
<span class="go">       [0, 0, 0, ..., 0, 0, 0],</span>
<span class="go">       [0, 0, 0, ..., 0, 0, 0]], dtype=uint8)</span>
</pre></div>
</div>
<p>This 2D array is a valid data mask in the sense of <a class="reference external" href="https://trac.osgeo.org/gdal/wiki/rfc15_nodatabitmask">GDAL RFC 15</a>. The <code class="docutils literal notranslate"><span class="pre">0</span></code> values in its
corners represent <em>nodata</em> regions. Zooming in on the interior of the mask
array shows the <code class="docutils literal notranslate"><span class="pre">255</span></code> values that indicate <em>valid data</em> regions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">msk</span><span class="p">[</span><span class="mi">200</span><span class="p">:</span><span class="mi">205</span><span class="p">,</span><span class="mi">200</span><span class="p">:</span><span class="mi">205</span><span class="p">]</span>
<span class="go">array([[255, 255, 255, 255, 255],</span>
<span class="go">       [255, 255, 255, 255, 255],</span>
<span class="go">       [255, 255, 255, 255, 255],</span>
<span class="go">       [255, 255, 255, 255, 255],</span>
<span class="go">       [255, 255, 255, 255, 255]], dtype=uint8)</span>
</pre></div>
</div>
<p>Displayed using Matplotlib’s <cite>imshow()</cite>, the mask looks like this:</p>
<img alt="../_images/mask_band.png" src="../_images/mask_band.png" />
<p>Wait, what are these 0 values in the mask interior? This is an example of
a problem inherent in 8-bit raster data: lack of dynamic range. The dataset
creator has said that 0 values represent missing data (see the
<code class="docutils literal notranslate"><span class="pre">nodatavals</span></code> property in the first code block of this document), but some of
the valid data have values so low they’ve been rounded during processing to
zero.  This can happen in scaling 16-bit data to 8 bits.  There’s
no magic nodata value bullet for this. Using 16 bits per band helps, but you
really have to be careful with 8-bit per band datasets and their nodata values.</p>
</div>
<div class="section" id="writing-masks">
<h2>Writing masks<a class="headerlink" href="masks.html#writing-masks" title="Permalink to this headline">¶</a></h2>
<p>Writing a mask that applies to all dataset bands is just as straightforward:
pass an ndarray with <code class="docutils literal notranslate"><span class="pre">True</span></code> (or values that evaluate to <code class="docutils literal notranslate"><span class="pre">True</span></code> to indicate
valid data and <code class="docutils literal notranslate"><span class="pre">False</span></code> to indicate no data to <code class="docutils literal notranslate"><span class="pre">write_mask()</span></code>. Consider a
copy of the test data opened in “r+” (update) mode.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">shutil</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">rasterio</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tmp</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;tests/data/RGB.byte.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;/tmp/RGB.byte.tif&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r+&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To mark that all pixels of all bands are valid (i.e., to override nodata
metadata values that can’t be unset), you’d do this.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">src</span><span class="o">.</span><span class="n">write_mask</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">src</span><span class="o">.</span><span class="n">read_masks</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>No data have been altered, nor have the dataset’s nodata values been changed.
A new band has been added to the dataset to store the valid data mask.  By
default it is saved to a “sidecar” GeoTIFF alongside the dataset file. When
such a .msk GeoTIFF exists, Rasterio will ignore the nodata metadata values and
return mask arrays based on the .msk file.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -l copy.tif*
<span class="go">-rw-r--r--@ 1 sean  staff  1713704 Mar 24 14:19 copy.tif</span>
<span class="go">-rw-r--r--  1 sean  staff      916 Mar 24 14:25 copy.tif.msk</span>
</pre></div>
</div>
<p>Can Rasterio help fix buggy nodata masks like the ones in RGB.byte.tif? It
certainly can. Consider a fresh copy of that file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">src</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tmp</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;tests/data/RGB.byte.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;/tmp/RGB.byte.tif&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r+&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This time we’ll read all 3 band masks
(based on the nodata values, not a .msk GeoTIFF) and show them
as an RGB image (with the help of <cite>numpy.dstack()</cite>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">msk</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read_masks</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">msk</span><span class="p">))</span>  
</pre></div>
</div>
<img alt="../_images/mask_bands_rgb.png" src="../_images/mask_bands_rgb.png" />
<p>Colored regions appear where valid data pixels don’t quite coincide. This is,
again, an artifact of scaling data down to 8 bits per band. We’ll begin by
constructing a new mask array from the logical conjunction of the three band
masks we’ve read.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_msk</span> <span class="o">=</span> <span class="p">(</span><span class="n">msk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">msk</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">msk</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show</span><span class="p">(</span><span class="n">new_msk</span><span class="p">)</span>  
</pre></div>
</div>
<img alt="../_images/mask_conj.png" src="../_images/mask_conj.png" />
<p>Now we’ll use <cite>sieve()</cite> to shake out the small buggy regions of the mask. I’ve
found the right value for the <code class="docutils literal notranslate"><span class="pre">size</span></code> argument empirically.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rasterio.features</span> <span class="kn">import</span> <span class="n">sieve</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sieved_msk</span> <span class="o">=</span> <span class="n">sieve</span><span class="p">(</span><span class="n">new_msk</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show</span><span class="p">(</span><span class="n">sieved_msk</span><span class="p">)</span>  
</pre></div>
</div>
<img alt="../_images/mask_sieved.png" src="../_images/mask_sieved.png" />
<p>Last thing to do is write that sieved mask back to the dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">src</span><span class="o">.</span><span class="n">write_mask</span><span class="p">(</span><span class="n">sieved_msk</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">src</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The result is a properly masked dataset that allows some 0 value pixels to be
considered valid.</p>
</div>
<div class="section" id="numpy-masked-arrays">
<h2>Numpy masked arrays<a class="headerlink" href="masks.html#numpy-masked-arrays" title="Permalink to this headline">¶</a></h2>
<p>If you want, you can read dataset bands as numpy masked arrays.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;tests/data/RGB.byte.tif&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blue</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blue</span><span class="o">.</span><span class="n">mask</span>
<span class="go">array([[ True,  True,  True, ...,  True,  True,  True],</span>
<span class="go">       [ True,  True,  True, ...,  True,  True,  True],</span>
<span class="go">       [ True,  True,  True, ...,  True,  True,  True],</span>
<span class="go">       ...</span>
<span class="go">       [ True,  True,  True, ...,  True,  True,  True],</span>
<span class="go">       [ True,  True,  True, ...,  True,  True,  True],</span>
<span class="go">       [ True,  True,  True, ...,  True,  True,  True]], dtype=bool)</span>
</pre></div>
</div>
<p>As mentioned earlier, this mask is the inverse of the GDAL band mask. To get
a mask conforming to GDAL RFC 15, do this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">msk</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">blue</span><span class="o">.</span><span class="n">mask</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can rely on this Rasterio identity for any integer value <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="o">~</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span> <span class="o">*</span> <span class="mi">255</span> <span class="o">==</span> <span class="n">src</span><span class="o">.</span><span class="n">read_masks</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="dataset-masks">
<h2>Dataset masks<a class="headerlink" href="masks.html#dataset-masks" title="Permalink to this headline">¶</a></h2>
<p>Sometimes a per-band mask is not appropriate. In this case you can either
construct a mask out of the component bands (or other auxillary data) manually
<em>or</em> use the Rasterio dataset’s <code class="docutils literal notranslate"><span class="pre">src.dataset_mask()</span></code> function. This returns
a 2D array with a GDAL-style mask determined by the following criteria,
in order of precedence:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>If a .msk file, dataset-wide alpha or internal mask exists,
it will be used as the dataset mask.</p></li>
<li><p>If a 4-band RGBA with a shadow nodata value,
band 4 will be used as the dataset mask.</p></li>
<li><p>If a nodata value exists, use the binary OR (|) of the band masks</p></li>
<li><p>If no nodata value exists, return a mask filled with all valid data (255)</p></li>
</ol>
</div></blockquote>
<p>Note that this differs from read_masks and GDAL RFC15 in that it applies
per-dataset, not per-band.</p>
</div>
<div class="section" id="nodata-representations-in-raster-files">
<h2>Nodata representations in raster files<a class="headerlink" href="masks.html#nodata-representations-in-raster-files" title="Permalink to this headline">¶</a></h2>
<p>The storage and representation of nodata differs depending on the data format
and configuration options. While Rasterio provides an abstraction for those
details when reading, it’s often important to understand the differences when
creating, manipulating and writing raster data.</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Nodata values</strong>: the <code class="docutils literal notranslate"><span class="pre">src.nodata</span></code> value is used to define which pixels should be masked.</p></li>
<li><p><strong>Alpha band</strong>: with RGB imagery, an additional 4th band (containing a GDAL-style 8-bit mask) is sometimes provided to explictly define the mask.</p></li>
<li><p><strong>Internal mask band</strong>: GDAL provides the ability to store an additional boolean 1-bit mask that is stored internally to the dataset. This option relies on a GDAL environment with <code class="docutils literal notranslate"><span class="pre">GDAL_TIFF_INTERNAL_MASK=True</span></code>. Otherwise the mask will be written externally.</p></li>
<li><p><strong>External mask band</strong>: Same as above but the mask band is stored in a sidecar <code class="docutils literal notranslate"><span class="pre">.msk</span></code> file (default).</p></li>
</ul>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="memory-files.html" class="btn btn-neutral float-right" title="In-Memory Files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="masking-by-shapefile.html" class="btn btn-neutral float-left" title="Masking a raster using a shapefile" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Mapbox
      
        <span class="commit">
          Revision <code>3ae51c8e</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../index.html">latest</a></dd>
        
          <dd><a href="https://rasterio.readthedocs.io/en/stable/">stable</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://rasterio.readthedocs.io/_/downloads/en/latest/pdf/">pdf</a></dd>
        
          <dd><a href="https://rasterio.readthedocs.io/_/downloads/en/latest/htmlzip/">html</a></dd>
        
          <dd><a href="https://rasterio.readthedocs.io/_/downloads/en/latest/epub/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="https://readthedocs.org/projects/rasterio/?fromdocs=rasterio">Project Home</a>
          </dd>
          <dd>
            <a href="https://readthedocs.org/builds/rasterio/?fromdocs=rasterio">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>